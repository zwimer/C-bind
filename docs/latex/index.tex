\href{https://travis-ci.org/zwimer/C-bind}{\tt }

\section*{Table of Contents}


\begin{DoxyEnumerate}
\item \href{#requirements}{\tt Requirements}
\end{DoxyEnumerate}
\begin{DoxyEnumerate}
\item \href{#usage}{\tt Usage}
\begin{DoxyItemize}
\item \href{#general}{\tt General}
\item \href{#systemv}{\tt SystemV}
\item \href{#non-systemv}{\tt Non-\/\+SystemV}
\end{DoxyItemize}
\end{DoxyEnumerate}
\begin{DoxyEnumerate}
\item \href{#testing}{\tt Testing}
\end{DoxyEnumerate}
\begin{DoxyEnumerate}
\item \href{#compilation}{\tt Compilation}
\end{DoxyEnumerate}
\begin{DoxyEnumerate}
\item \href{#docker}{\tt Docker}
\end{DoxyEnumerate}
\begin{DoxyEnumerate}
\item \href{#ci}{\tt CI}
\end{DoxyEnumerate}
\begin{DoxyEnumerate}
\item \href{#documentation}{\tt Documentation}
\end{DoxyEnumerate}
\begin{DoxyEnumerate}
\item \href{#future-plans}{\tt Future Plans} 


\end{DoxyEnumerate}

\section*{Requirements}

Currently {\ttfamily C-\/bind} requires {\ttfamily pthread} to be installed, and requires {\ttfamily x86\+\_\+64}. {\ttfamily C-\/bind} has only been tested on {\ttfamily Ubuntu 18.\+04}, compiled with {\ttfamily gcc 7.\+3}.

\section*{Usage}

\subsection*{General}

\subsubsection*{Includes}

To link the {\ttfamily C-\/bind} library simply include the header file {\ttfamily \hyperlink{bind_8h}{bind.\+h}}.

\subsubsection*{Setup}

To setup the bind library, the {\ttfamily bind\+\_\+setup} function must be invoked first! 
\begin{DoxyCode}
\hyperlink{bind_8c_a57d49e18c9326489d842187e2a1e0086}{bind\_setup}();
\end{DoxyCode}


\subsubsection*{Invocation}

To invoke the bound version of {\ttfamily my\+\_\+func}, one could simply invoke it as 
\begin{DoxyCode}
bound\_func( arg1, arg2, arg3 )
\end{DoxyCode}
 {\itshape Note}\+: if you pass extra unexpected arguments to {\ttfamily bound\+\_\+func} they will be ignored.

\subsubsection*{SystemV vs Non-\/\+SystemV}

The most common calling convention of {\ttfamily x86\+\_\+64} / {\ttfamily amd64} is called SystemV. Unless otherwise specified, most major compilers should compile your code to meet this standard. This library provides functions for binding functions that follow the SystemV calling convention; functions that are not compliant have an A\+PI for them is provided for them as well. The default A\+PI of this library assumes SystemV functions are being bound.

\subsubsection*{Thread Safe}

Yes.

\subsubsection*{Important notes}


\begin{DoxyEnumerate}
\item This library uses a signal internally. By default this is {\ttfamily S\+I\+G\+U\+S\+R2}, however the user may change this whenever. This signal handler is install when-\/needed and restored when not, so for a single threaded application this is perfectly safe. However, in a multi-\/threaded enviornment it is important to set this signal to some (valid) unused signal! This can be done with the {\ttfamily bind\+\_\+set\+\_\+signal\+\_\+number} function.
\end{DoxyEnumerate}

\subsubsection*{Restrictions}


\begin{DoxyEnumerate}
\item This library cannot bind variadic functions
\end{DoxyEnumerate}
\begin{DoxyEnumerate}
\item This library {\itshape may} fail if registers other than {\ttfamily rdi}, {\ttfamily rsi,} {\ttfamily rdx}, {\ttfamily rcx}, {\ttfamily r8}, and {\ttfamily r9} are used to pass arguments. However this is exceedingly rare.
\end{DoxyEnumerate}
\begin{DoxyEnumerate}
\item This library will only compile for {\ttfamily x86\+\_\+64} / {\ttfamily amd64}
\end{DoxyEnumerate}

\subsection*{SystemV}

\subsubsection*{Function Signature}

SystemV functions to be bound must return an object of type {\ttfamily ret\+\_\+t} (which should be 8 bytes) or smaller; {\ttfamily void} is also valid. Do not attempt to return a large struct as it may fail! As for the arguments of the function, there are no restrictions except that the function may not be variadic! Consequently, {\ttfamily my\+\_\+func} must have a defined maximum number of \textquotesingle{}arguments\textquotesingle{}. {\itshape That is, {\ttfamily my\+\_\+func} must expect that no more {\ttfamily num\+\_\+args} number of elements to be passed.} For more info look in the {\ttfamily \hyperlink{bind__defs_8h}{bind\+\_\+defs.\+h}} file.

\subsubsection*{Full binding}

To fully bind a functon, invoke 
\begin{DoxyCode}
bound\_func = \hyperlink{bind_8c_a31fdc3dfcbd70d3f32f4e3c8a2084c6a}{full\_bind}( my\_func, num\_args, arg1, arg2, arg3 )
\end{DoxyCode}
 Here {\ttfamily num\+\_\+args} is the number arguments to pass to be passed to {\ttfamily my\+\_\+func}. If you pass in more arguments {\ttfamily num\+\_\+args} they will be ignored.

\#\#\# Full binding example 
\begin{DoxyCode}
\textcolor{keywordtype}{int} sum( \textcolor{keywordtype}{int} a, \textcolor{keywordtype}{int} b ) \{ \textcolor{keywordflow}{return} a + b; \}
bound\_func = \hyperlink{bind_8c_a31fdc3dfcbd70d3f32f4e3c8a2084c6a}{full\_bind}( sum, 2, \textcolor{comment}{/* Arguments begin */} 1, 2 );
printf( \textcolor{stringliteral}{"sum(1,2) = %d"}, (\textcolor{keywordtype}{int}) bound\_func() );
\end{DoxyCode}
 The output of this code is\+: {\ttfamily sum(1,2) = 3}.

\subsubsection*{Partial binding}

To partially bind a function, invoke 
\begin{DoxyCode}
bound\_func = \hyperlink{bind_8c_a187e674be73b611c4e8d97345192757a}{partial\_bind}( my\_func, num\_args, num\_args\_to\_bind, arg1, arg2 );
\end{DoxyCode}
 Here {\ttfamily num\+\_\+args\+\_\+to\+\_\+bind} is the number of arguments currently being bound!

\#\#\# Partial binding Example 
\begin{DoxyCode}
\textcolor{keywordtype}{int} sum3(\textcolor{keywordtype}{int} a, \textcolor{keywordtype}{int} b, \textcolor{keywordtype}{int} c) \{ \textcolor{keywordflow}{return} args[0] + args[1] + args[2]; \}
bound\_func = \hyperlink{bind_8c_a187e674be73b611c4e8d97345192757a}{partial\_bind}( sum3, 3, 2, \textcolor{comment}{/* Arguments begin */} 100, 200 );
printf( \textcolor{stringliteral}{"Total sum = %d"}, (\textcolor{keywordtype}{int}) bound\_func(300) );
\end{DoxyCode}
 The output of this code is\+: {\ttfamily Total sum = 600}

\subsection*{Non-\/\+SystemV}

\subsubsection*{Signature}

Non-\/\+SystemV functions to be bound must have a unique signature, however when calling them they may be called as standard functions. To bind a function, it must have the following signature\+: 
\begin{DoxyCode}
\hyperlink{bind__defs_8h_a54aeeb54a7a6a62c72ec8dc7718fdd91}{ret\_t} my\_func( \hyperlink{bind__defs_8h_aa409ee08129c587e002cf2062a09a744}{arg\_t} * args )
\end{DoxyCode}
 The return value may simply be any other primitive so you cast it properly during the binding call. You can think of {\ttfamily args} as an array of arguments! The function being bound may not be variadic, consequently, {\ttfamily my\+\_\+func} must have a defined maximum number of \textquotesingle{}arguments\textquotesingle{}. {\itshape That is, {\ttfamily my\+\_\+func} must expect that no more {\ttfamily num\+\_\+args} number of elements to be passed.} For more info look in the {\ttfamily \hyperlink{bind__defs_8h}{bind\+\_\+defs.\+h}} file. Parsing the {\ttfamily args} array is the job of {\ttfamily my\+\_\+func}.

\subsubsection*{Full binding}

To fully bind a functon, invoke 
\begin{DoxyCode}
bound\_func = \hyperlink{bind_8c_a31fdc3dfcbd70d3f32f4e3c8a2084c6a}{full\_bind}( my\_func, num\_args, arg1, arg2, arg3 )
\end{DoxyCode}
 Here {\ttfamily num\+\_\+args} is the number of elements in the {\ttfamily args} array {\ttfamily my\+\_\+func} expects to be passed. If you pass in more arguments {\ttfamily num\+\_\+args} they will be ignored.

\#\#\# Full binding Example 
\begin{DoxyCode}
\hyperlink{bind__defs_8h_a54aeeb54a7a6a62c72ec8dc7718fdd91}{ret\_t} sum( \hyperlink{bind__defs_8h_aa409ee08129c587e002cf2062a09a744}{arg\_t} * args ) \{ \textcolor{keywordflow}{return} args[0] + args[1]; \}
bound\_func = full\_systemv\_bind( sum, 2, \textcolor{comment}{/* Arguments begin */} 1, 2 );
printf( \textcolor{stringliteral}{"sum(1,2) = %d"}, (\textcolor{keywordtype}{int}) bound\_func() );
\end{DoxyCode}
 The output of this code is\+: {\ttfamily sum(1,2) = 3}.

\subsubsection*{Partial binding}

To partially bind a function, invoke 
\begin{DoxyCode}
bound\_func = \hyperlink{bind_8c_a187e674be73b611c4e8d97345192757a}{partial\_bind}( my\_func, num\_args, num\_args\_to\_bind, arg1, arg2 );
\end{DoxyCode}
 Here {\ttfamily num\+\_\+args\+\_\+to\+\_\+bind} is the number of arguments currently being bound!

\#\#\# Partial binding Example 
\begin{DoxyCode}
\hyperlink{bind__defs_8h_a54aeeb54a7a6a62c72ec8dc7718fdd91}{ret\_t} sum3( \hyperlink{bind__defs_8h_aa409ee08129c587e002cf2062a09a744}{arg\_t} * args ) \{ \textcolor{keywordflow}{return} args[0] + args[1] + args[2]; \}
bound\_func = partial\_systemv\_bind( sum3, 3, 2, \textcolor{comment}{/* Arguments begin */} 100, 200 );
printf( \textcolor{stringliteral}{"Total sum = %d"}, (\textcolor{keywordtype}{int}) bound\_func(300) );
\end{DoxyCode}
 The output of this code is\+: {\ttfamily Total sum = 600} 



\section*{Testing}

To test that this works first compile the code 
\begin{DoxyCode}
1 git clone https://github.com/zwimer/C-bind && \(\backslash\)
2 mkdir C-bind/src/build && cd C-bind/src/build && \(\backslash\)
3 cmake .. && make
\end{DoxyCode}


After that, run your desired test. Either {\ttfamily ./test.out} (for SystemV tests) or {\ttfamily ./test-\/non-\/systemv.out}.

\section*{Compilation}

This library should be compiled as a shared object without optimizations! See the {\ttfamily C\+Make} file for more details.

\section*{Docker}

A {\ttfamily Dockerfile} is provided with {\ttfamily C-\/bind} and example cases installed and build. The image is hosted \href{https://cloud.docker.com/repository/docker/zwimer/c-bind}{\tt here} on \href{https://docker.com}{\tt docker.\+com}. To pull the image just execute\+: 
\begin{DoxyCode}
1 docker pull zwimer/c-bind
\end{DoxyCode}
 To run the container simply execute\+: 
\begin{DoxyCode}
1 docker run --rm -it zwimer/c-bind
\end{DoxyCode}
 If you would like to build the container yourself execute\+: 
\begin{DoxyCode}
1 git clone https://github.com/zwimer/C-bind && \(\backslash\)
2 cd C-bind && \(\backslash\)
3 docker build -t c-bind .
\end{DoxyCode}


\section*{CI}

Continuous Integration is provided by \href{https://travis-ci.org}{\tt Travis CI}. To view the CI setup, click \href{https://travis-ci.org/zwimer/C-bind/}{\tt here}.

\section*{Documentation}

Documentation is stored in on the {\ttfamily gh-\/pages} branch and hosted \href{https://zwimer.github.io/C-bind/docs/html/index.html}{\tt here} on \href{https://zwimer.com}{\tt zwimer.\+com}. Documentation is generated via \href{http://www.doxygen.nl/}{\tt doxygen}. To manually generate it install doxygen (from {\ttfamily apt-\/get} if you have it) then 
\begin{DoxyCode}
1 cd C-bind && doxygen
\end{DoxyCode}


\section*{Future Plans}


\begin{DoxyEnumerate}
\item Right now the {\ttfamily get\+\_\+stub} function maps an entire page of memory per stub generated. Realistically it should only require just a few bytes. This can be done by placing multiple stub functions on the same page. 
\end{DoxyEnumerate}